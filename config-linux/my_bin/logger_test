#!/usr/bin/env bats
#
# Functional tests written with bats - https://github.com/sstephenson/bats
#
# if bats not installed:
#   git clone https://github.com/sstephenson/bats.git
#   cd bats
#   ./install.sh /usr/local

# required: bats and BASH 4.2+


# validate required bash version
if [[ "${BASH_VERSINFO[0]}" -ge 4  && "${BASH_VERSINFO[1]}" -ge 2 ]]; then
  echo "validated bash version is greater than 4.2"
  gum 
  echo "Require at least bash 4.2 to run these tests." >&2
  exit 1
fi

# source logger library
logger_library="${0%/*}/logger"
if [[ -e "${logger_library}" ]]; then
  source "${logger_library}"
else
  echo "Attempted to source ${logger_library}, but the file in question does not exist." >&2
  exit 1 
fi

function setup {
  rm -rf "${HOME}/logs"
}

function teardown {
  mkdir -p "${HOME}/bats/"
  cat "${HOME}/logs/*" >> "${HOME}/bats/${logger_library | tr '/' '.'}" 
}

@test "log_info with debug on" {
  LOG_LEVEL='DEBUG'
  if ping -c google.com; then
    log_info "you're on the net!"
  fi

  # TODO(Jonathan) validate log file has appropriate text and output read appropriately
}

